{% extends "base.html" %}

{% block title %}Chore Allocation - Home{% endblock %}

{% block content %}
<form id="allocation-form" action="{{ url_for('main.calculate') }}" method="post">
    <!-- Progress Indicator (hidden on step 1 and result screen) -->
    <div id="progress-indicator" class="progress-indicator hidden">
        <span id="step-label" class="step-label">Step 1 of 1</span>
        <div class="progress-bar">
            <div id="progress-fill" class="progress-fill" style="width: 100%;"></div>
        </div>
    </div>

    <!-- Step 1: Add Agents and Chores (hidden when showing results) -->
    <div id="step-1" class="step {% if not result %}active{% endif %}">
        <div class="form-container">
            <!-- Agents Section -->
            <section class="list-section">
                <h2>Agents</h2>
                <p class="section-description">Add the people who will share the chores</p>

                <div class="add-item-row">
                    <input
                        type="text"
                        id="agent-input"
                        placeholder="Enter agent name"
                        autocomplete="off"
                    >
                    <button type="button" onclick="addAgent()">Add Agent</button>
                </div>

                <ul id="agents-list" class="item-list">
                    {% for agent in agents %}
                    <li>
                        <span>{{ agent }}</span>
                        <input type="hidden" name="agents" value="{{ agent }}">
                        <button type="button" class="remove-btn" onclick="removeItem(this)">Remove</button>
                    </li>
                    {% endfor %}
                </ul>

                <p id="agents-empty" class="empty-message" {% if agents %}style="display: none;"{% endif %}>
                    No agents added yet
                </p>
            </section>

            <!-- Chores Section -->
            <section class="list-section">
                <h2>Chores</h2>
                <p class="section-description">Add the tasks to be distributed</p>

                <div class="add-item-row">
                    <input
                        type="text"
                        id="chore-input"
                        placeholder="Enter chore name"
                        autocomplete="off"
                    >
                    <button type="button" onclick="addChore()">Add Chore</button>
                </div>

                <ul id="chores-list" class="item-list">
                    {% for chore in chores %}
                    <li>
                        <span>{{ chore }}</span>
                        <input type="hidden" name="chores" value="{{ chore }}">
                        <button type="button" class="remove-btn" onclick="removeItem(this)">Remove</button>
                    </li>
                    {% endfor %}
                </ul>

                <p id="chores-empty" class="empty-message" {% if chores %}style="display: none;"{% endif %}>
                    No chores added yet
                </p>
            </section>
        </div>

        <!-- Next Button -->
        <div class="nav-buttons nav-buttons--single">
            <button type="button" id="btn-next-to-values" class="btn-next" onclick="goToCostValues()" disabled>
                Next: Enter cost Values
            </button>
        </div>
    </div>

    <!-- Container for dynamically generated agent cost steps -->
    <div id="cost-steps-container"></div>

    <!-- Hidden inputs for cost values (populated by JS before submit) -->
    <div id="cost-hidden-inputs"></div>
</form>

<!-- Result Screen (standalone, shown when results exist) -->
{% if result %}
<div id="result-screen" class="step active">
    <section class="result-section">
        <h2>Allocation Result</h2>
        <div class="result-content">
            <p class="result-status result-status--{{ result.status }}">
                <strong>Status:</strong> {{ result.status }}
            </p>
            <p class="result-message">{{ result.message }}</p>
            <div class="result-stats">
                <p><strong>Agents:</strong> {{ result.agents_count }}</p>
                <p><strong>Chores:</strong> {{ result.chores_count }}</p>
            </div>
        </div>
    </section>
    <div class="nav-buttons nav-buttons--single">
        <a href="{{ url_for('main.index') }}" class="btn-next">Start Over</a>
    </div>
</div>
{% endif %}
{% endblock %}
